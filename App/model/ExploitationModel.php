<?php

    namespace Cineflix\App\Model;

    use Cineflix\Core\Util\Security;

    class ExploitationModel extends AbstractModel
    {

        protected string $debut;
        protected string $fin;
        protected bool $soon_delete = false;

        public function __construct(?array $data)
        {
            parent::__construct($data);
            $this->setDebut($data['debut']);


            $this->setFin($data['fin']);
            $this->setSoonDelete();


        }

        public function __get($item): mixed
        {
            switch ($item) {
                case 'debut_fr':
                    $item = ($this->debut)? $this->getDateFr($this->debut) : '';
                    break;
                case 'fin_fr':
                    $item = ($this->fin)? $this->getDateFr($this->fin) : '';
                    break;
                case 'debut':
                case 'fin':
                case 'soon_delete':
                    $item = $this->$item;
                    break;
                default:
                    $item = parent::__get($item);
            }

            return $item;
        }
        public function setDebut(string $date): void
        {
            $this->debut = Security::sanitize($date);
        }

        public function getDebut(): string
        {
            return (!empty($this->debut)) ? $this->debut : '';
        }

        public function setFin(string $date): void
        {
            $this->fin = Security::sanitize($date);
        }

        public function getFin(): string
        {
            return (!empty($this->fin)) ? $this->fin : '';
        }

        public function setSoonDelete(): void
        {
            $targetDate = new \DateTime($this->fin);
            $targetDate->modify('-2 days');
            $targetTimestamp = $targetDate->getTimestamp();

            $this->soon_delete = time() >= $targetTimestamp;
        }

    }
